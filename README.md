# R&D: Multiple Testing and Rerandomization in A/B Experiments

## Что внутри репозитория
Этот репозиторий оформлен как минимальный, но «взрослый» R&D-пакет по двум вопросам:
1. Нужна ли поправка на множественные тестирования в **финальном анализе A/B-теста** по нескольким метрикам.
2. Нужна ли такая поправка на этапе **проверки гомогенности до старта пилота** при рерандомизации.

## Структура
- `report/report.md` — основной отчёт (расширенная версия на русском).
- `report/report.pdf` — PDF-версия отчёта с содержанием и библиографией.
- `report/report_for_pdf.txt` — текстовый источник для сборки PDF.
- `report/simulation_results.csv` — пример результатов симуляции.
- `code/simulation_balance_vs_mht.py` — воспроизводимая симуляция правил приемки сплита.
- `scripts/execute_notebooks.py` — выполнение всех `ipynb` с обновлением output.
- `scripts/generate_pdf.py` — генерация PDF без внешних зависимостей.
- `1_multi_test_corrertions/multi_test_corrertions.ipynb` — мини-демо корректировок.
- `2_rerand_iter_number/rerand_iter_number.ipynb` — мини-демо вероятности ложного срабатывания.

## Ключевые выводы (кратко)
- Для **финального вывода** по нескольким целевым метрикам поправка на множественные проверки нужна (FWER/FDR — по контексту принятия решений).
- Для **балансировки/гомогенности до пилота** лучше использовать заранее зафиксированный критерий дисбаланса (например, SMD и агрегированный score), а не только правило на множественных p-value.

## Как воспроизвести артефакты
### 1) Запустить симуляцию
```bash
python code/simulation_balance_vs_mht.py --n-iter 500 --n 500 --feature-grid 5,10,20,50 --output report/simulation_results.csv
```

### 2) Пересобрать PDF
```bash
python scripts/generate_pdf.py
```

### 3) Выполнить и сохранить outputs во всех ноутбуках
```bash
python scripts/execute_notebooks.py
```

## Формат артефактов по итогам R&D
Рекомендуемый «репрезентативный» набор:
1. Текстовый отчёт + PDF-версия с библиографией.
2. Воспроизводимый код симуляций.
3. Табличные результаты симуляций (`csv`).
4. Исполненные ноутбуки как иллюстрации.
5. README как runbook с точными командами.

## Ограничения
- PDF генерируется встроенным скриптом без внешних пакетов; поэтому форматирование минималистичное.
- Симуляция реализована на чистом Python (без `numpy/pandas/scipy`) для гарантированной воспроизводимости в ограниченной среде.
