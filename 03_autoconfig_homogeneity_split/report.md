# RnD-3: Data-driven автоконфиг homogeneity test и AB split

## Контекст и постановка
В HypEx нужен автоматический подбор параметров контроля баланса при рерандомизации: число ключевых ковариат, порог принятия, бюджет итераций.

## Вопросы и гипотезы
- H1: фиксированный жёсткий threshold плохо переносится между сценариями N/K/correlation.
- H2: адаптация через целевой acceptance-rate стабилизирует процесс.
- H3: приоритизация top-covariates снижает стоимость без существенной потери качества.

## Методология и план экспериментов
Синтетический генератор строит данные с управляемыми N, K и корреляцией. Автоконфиг:
1. Пилотные random-split попытки оценивают эмпирическое распределение `max|SMD|`.
2. Порог выбирается как квантиль для целевого acceptance-rate.
3. `max_iter` выбирается из требуемой вероятности успеха.
4. В ключевой контроль включаются top-M признаков по важности.

## Результаты
Ноутбук показывает, что auto-policy держит стабильный уровень качества баланса и сокращает число безуспешных прогонов при росте K.
Ключевые числа в таблицах `policy_table` и `eval_table`. Графики — в разделах **"Калибровка"** и **"Оценка качества"**.

## Выводы и рекомендации
Рекомендуемый рецепт:
- Оценить `s = max|SMD|` на 200–500 случайных сплитах.
- Выбрать `tau = quantile(s, q)` для `q=0.05..0.15` (в зависимости от SLA).
- Поставить `max_iter = ceil(log(1-target_success)/log(1-q))`.
- Контролировать top-M признаков: `M = min(20, max(5, round(sqrt(K))))`.
- При неуспехе смягчать только низкоприоритетные признаки.

Псевдокод см. в заключительной ячейке ноутбука.

## Ссылки
- `01_bonferroni_aa_matching/report.md`
- FDA Multiple Endpoints Guidance (2022)
- Benjamini & Hochberg (1995)
- de Boer et al. (2015)
- `docs/CONTEXT_TZ.md`
